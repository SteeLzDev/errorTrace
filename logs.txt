add fix pagination /receivables endpoint and DE/PARA onboarding endpoint

Start review
Overview
Diff
Commits
Builds
Oliveira, Davi
Oliveira, Davi created a pull request22 mins ago
No description for this pull request.


Add one
GEFI-4713
Activity
Oliveira, Davi
What do you want to say?
artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/infrastructure/integration/feign/client/antecipa/AntecipaServiceImpl.java
artemis
artemis
21 mins ago

New
[BUG] The mapping for statusId in mapApiStatusToEnum has changed, including swapping mappings for key business statuses. Be sure these changes do not break business logic or introduce risk of incorrect onboarding status mapping. Test all affected flows thoroughly to avoid unintended side-effects. Example: verify that 'case 1' now means STARTED (New) instead of APPROVED (Active).

Reply

Resolve


artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/application/rest/HistoryController.java
    @LogMethod(LogMethod.LogType.FULL)
    public ResponseEntity<HistoryResponseTO> findHistory(String capitalSourceDocument,
                                                         LocalDate anticipationDate,
    public ResponseEntity<HistoryResponseTO> findHistory(LocalDate anticipationDate,
                                                         String statusId,
                                                         String pageId,
                                                         Integer pageSize) {
                                                         Integer limit,
                                                         Integer offset) {
        final int pageLimit = limit != null ? limit : 10;
        final int pageOffset = offset != null ? offset : 0;
artemis
artemis
21 mins ago

New
[SECURITY] The default values for 'limit' and 'offset' (10 and 0) are hardcoded. Consider validating and constraining the values to prevent unintentional large queries, negative offsets, or possible resource exhaustion (CWE-770: Allocation of Resources Without Limits or Throttling). Example improvement:
final int pageLimit = (limit != null && limit > 0 && limit <= 100) ? limit : 10;
final int pageOffset = (offset != null && offset >= 0) ? offset : 0;

Reply

Resolve


​
        String anticipationDateStr = anticipationDate != null ? anticipationDate.toString() : null;
​
        Optional<HistoryResponseTO> historyOpt = this.historyService.findHistoryWithReceivables(capitalSourceDocument,
                anticipationDateStr, null, statusId, pageId, pageSize);
        Optional<HistoryResponseTO> historyOpt = this.historyService.findHistoryWithReceivables(
                anticipationDateStr, null, statusId, pageOffset, pageLimit);
​
        if (historyOpt.isEmpty()) {
            log.info("No anticipation history found for the given filters");
artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/application/rest/HistoryController.java
artemis
artemis
21 mins ago

New
[BUG] Potentially passing null (for the third argument) to historyService.findHistoryWithReceivables. If the receiving service does not handle nulls robustly, this can result in NullPointerExceptions (CWE-476: NULL Pointer Dereference). Consider verifying requirements of the API or documenting why null is being passed, or refactor to avoid nulls if possible.

Reply

Resolve


artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/infrastructure/integration/feign/client/antecipa/AntecipaServiceImpl.java
artemis
artemis
21 mins ago

New
[BUG] OnboardingStatus mapping for statusId=3 changed from REJECTED (Inactive) to PENDING (Pending). This can impact how the system handles rejected suppliers. Ensure this change is intentional and if not, update the mapping accordingly. Example: If REJECTED is expected, keep 'return OnboardingStatus.REJECTED;' for statusId=3.

Reply

Resolve


artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/domain/service/impl/HistoryServiceImpl.java
artemis
artemis
21 mins ago

New
[CODE SMELL] Overloading method names with similar signatures may cause confusion and maintenance difficulties. Both findHistoryWithReceivables methods only differ by parameter types/order, which can make the API harder to use and maintain. Consider using more descriptive method names or consolidating logic if possible. For example, use findHistoryWithReceivablesV2 for the new overload or clarify the naming based on their usage context.

Reply

Resolve


artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/domain/service/HistoryService.java
artemis
artemis
21 mins ago

New
[CODE SMELL] Overloaded method signatures are almost identical except for parameter names and types (pageId/pageSize vs offset/limit). This can lead to confusion and maintenance issues. Consider consolidating into a single method using a parameter object or standardized pagination parameters. Example: Create a PaginationParams class to encapsulate paging logic.

Reply

Resolve


artemis
artemis commented on a file21 mins ago
src/main/java/br/com/experian/anticipation/domain/service/impl/HistoryServiceImpl.java
        List<HistoryItemTO> historyItems = new ArrayList<>();
​
        for (AntecipaAnticipationCardReceivableListDto ext : externalItems) {
            HistoryItemTO item = createHistoryItem(ext, supplierDocument, token);
            historyItems.add(item);
        }
        return historyItems;
    }
​
    private HistoryItemTO createHistoryItem(AntecipaAnticipationCardReceivableListDto ext, String supplierDocument, String token) {

artemis
21 mins ago

New
[SECURITY] Catching generic Exception swallows all exceptions including unchecked ones, making debugging and error handling harder (CWE-248: Uncaught Exception). Catch more specific exceptions or rethrow after logging. Example: catch (FeignException | IOException e) { ... }.

Reply

Resolve



​
        HistoryItemTO item = new HistoryItemTO();
​
​
        String id = extractId(ext);
        item.setId(id);
​
​
        setRequestDate(item, ext);
​
