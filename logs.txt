eConsig - Alterar o uso do Twillo para o Zenvia
 Editar
 Adicionar comentário
Atribuir
Mais
Priorizado
SLA Report
Compartilhar este item
 Exportar
Detalhes do Item
Tipo: Tarefa
Resolução:Não Resolvido
Prioridade: Alta
Versões Corrigidas:Nenhum
Versões Afetadas:Nenhum
Componente(s):Nenhum
Nível de Segurança:Interna
Rótulos:
EPICO_SUBSTITUICAO_ENVIO_SMS_ZENVIA FY26Q02 FY26Q04 squad_econsig_produto
AA Sistema eConsig:
Geral |
Tipo Desenvolvimento:Modificação
Descrição de comportamento:
Como: produto eConsig
Quero: alterar a biblioteca de envio de SMS para Zenvia
Para: reduzir custos com envio de SMS

Sugestão de Implementação:
1) Criar 2 parâmetros de sistema (Domínio: Int):
1.1) um para configurar o limite inferior de envios de SMS por mês;
1.2) outro para configurar o limite superior de envios de SMS por mês, que bloqueia a operação.
 
2) Criar novo tipo de ocorrência para registrar o envio de SMS.
 
3) Atualmente o eConsig integra a Twillio para realizar o envio de SMS. Alterar para que passe a integrar com a Zenvia.
3.1) Realização o levantamento dos pontos que enviam SMS no sistema para fazer a alteração. Verificar se há mais cenários.
3.1.1) Alguns pontos levantados:
mensagem.sms.servidor.codigo.unico
mensagem.sms.novo.boleto.servidor
mensagem.sms.consignacao.aprovada
mensagem.sms.operacao.realizada.consignacao
mensagem.sms.nova.comunicacao.enviada
mensagem.sms.resumo.consignacao
mensagem.sms.reserva.margem
mensagem.sms.vencimento.autorizacao
mensagem.sms.senha.servidor.reiniciada
mensagem.sms.senha.servidor.alterada
mensagem.sms.senha.app.servidor.alterada
3.2) Documentação: https://zenvia.github.io/zenvia-openapi-spec/v2/#tag/SMS/paths/~1channels~1sms~1messages/post
3.3) Token de autenticação para a conta eConsig: 9xubNLZbHly0Uhk3BwclP8QfUBL7ZqAnk9IO
3.4) Enviar "econsign" no parâmetro "from".
3.5) Exemplo de requisição:

curl -request POST --url https://api.zenvia.com/v2/channels/sms/messages --header 'Content-Type: application/json' --header 'X-API-TOKEN: 9xubNLZbHly0Uhk3BwclP8QfUBL7ZqAnk9IO' --data '{
  "from":"econsign",
  "to":"5531984555555",
  "contents": [
 
{     "type": "text",     "text": "Teste de envio de SMS via Zenvia+"   }
]
}'
 
3.6) Exemplo Response:
 

{"from":"econsign","to":"5531984555555","contents":[
 
{"type":"text","text":"Teste de envio de SMS via Zenvia+"}
],"id":"f46b1034-93c0-40e8-a529-c39daa2a186b","direction":"OUT"}-
 
3.7) É possível utilizar como referência a classe de integração com a Zenvia da Salaryfits que foi feita na DESENV-24666.
 
4) Antes de realizar o envio, verificar se a quantidade de ocorrências do tipo do item 2 no mês atual ainda não atingiu o limite inferior definido no parâmetro criado no item 1.1.
4.1) Se não tiver atingido, realizar o envio do SMS e após registrar ocorrência do tipo criado no item 2.
4.2) Se já tiver atingido o limite inferior definido no parâmetro criado no item 1.1, mas não tiver atingido o limite do parâmetro superior criado no item 1.2, realizar o envio do SMS, registrar ocorrência do tipo criado no item 2 e enviar e-mail para o destinatário cadastrado no parâmetro de "Sistema 207 - E-mail do suporte do sistema", comunicando que o limite inferior foi atingido para sistema. Cadastrar o modelo de e-mail na tb_modelo_email. No modelo deve ser possível exibir o <@nome_sistema>.
4.3) Se além do limite inferior, também tiver atingido o limite superior definido no parâmetro criado no item 1.2, não enviar o SMS, exibir erro na operação e enviar e-mail para o destinatário cadastrado no parâmetro de "Sistema 207 - E-mail do suporte do sistema", comunicando que o limite superior foi atingido para sistema. Cadastrar o modelo de e-mail na tb_modelo_email. No modelo deve ser possível exibir o <@nome_sistema>.

Critérios de aceitação:
I) Scenario: Enviar SMS
Given: que os parâmetros de limite inferior e superior de envios de SMS por mês estão configurados
When: é realizada uma ação que envia SMS
And: o número de ocorrências de envio no mês não atingiu o limite inferior
Then: o sistema envia o SMS
And: registra a ocorrência de consignante de envio de SMS
 
II) Scenario: Enviar SMS e comunicar que atingiu o limite inferior
Given: que os parâmetros de limite inferior e superior de envios de SMS por mês estão configurados
When: é realizada uma ação que envia SMS
And: o número de ocorrências de envio no mês atingiu o limite inferior
But: não atingiu o limite superior
Then: o sistema envia o SMS
And: registra a ocorrência de consignante de envio de SMS
And: envia e-mail para o suporte comunicando que o limite inferior foi atingido para o sistema
 
III) Scenario: Não enviar SMS
Given: que os parâmetros de limite inferior e superior de envios de SMS por mês estão configurados
When: é realizada uma ação que envia SMS
And: o número de ocorrências de envio no mês atingiu o limite superior
Then: o sistema não envia o SMS
And:  exibe mensagem de erro na operação
And: envia e-mail para o suporte comunicando que o limite superior foi atingido para o sistema

Release Notes:
Modificação do serviço de integração de envio de SMS da Twilio para Zenvia. Inclusão de parâmetros de sistema para configurar o limite inferior de envio de SMS, que apenas alerta sobre o limite excedido, e o limite superior, que bloqueio o envio de SMS.
Quais sistemas sofrem impacto?:
eConsig
Estimativa AR:3
Estimativa HH:51
Complexidade:Alta
Complexidade de Teste:Alta
Complexidade Considerada:Alta
Risco:Baixa
Empresa:Salt
Área Solicitante:Diretoria Técnica
Classificar:Maintenance
Descrição
A Serasa possui um contrato com a Zenvia. Precisamos alterar a integração para utilizar com o objetivo de reduzir custos.

Em anexo a documentação.


mSyM-zu4BaeVo4rEICFKiaqIHWuopkHiVyOu

